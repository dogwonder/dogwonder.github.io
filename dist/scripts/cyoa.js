function getContrastYIQ(t){var e=parseInt(t.substr(0,2),16),n=parseInt(t.substr(2,2),16),s=parseInt(t.substr(4,2),16),o=(299*e+587*n+114*s)/1e3;return o>=131.5?"rgba(0,0,0,.8)":"white"}function rgb2hex(t){function e(t){return("0"+parseInt(t).toString(16)).slice(-2)}return t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),e(t[1])+e(t[2])+e(t[3])}!function(t){t.Cyoa=function(e,n){var s,o,a,i,r=[],l={start_page:"start",container:"cyoa_container",separator:"|",control_position:"split",init:function(t,e){if(i=this,i.story=t,e)for(var n in e)i[n]=e[n];if("string"==typeof t)return i.story=i.make_story_from_google_spreadsheet(t),i;i.create_cover();for(var s in i.story)i.create_page(s);return i.add_to_path(i.start_page),i.display_page(i.start_page),i},make_story_from_google_spreadsheet:function(t){Tabletop.init({key:t,callback:function(t){var e=i.make_story_data_from_spreadsheet_data(t);i.init(e,n)},simpleSheet:!0,proxy:i.tabletop_proxy})},make_story_data_from_spreadsheet_data:function(t){var e={};i.start_page="cyoa_page_"+i.clean_slug(t[0].slug);for(var n=0;n<t.length;n++){var s=t[n],o={};o.html=i.build_story_page_html_from_row(s),o.connects=i.make_connects_data_from_row(s),e["cyoa_page_"+i.clean_slug(s.slug)]=o}return e},build_story_page_html_from_row:function(t){return(t.title?"<h1>"+t.title+"</h1>":"")+"<p>"+t.text+"</p><img src ="+t.backgroundimage+">"},clean_slug:function(t){return t.replace(/[^a-zA-Z0-9]/g,"").toLowerCase()},make_connects_data_from_row:function(t){for(var e=[],n=t.connectsto.split(i.separator),s=t.connectstext.split(i.separator),o=0;o<n.length;o++){a=n[o].toLowerCase();var a=a.replace(/[^a-zA-Z0-9]/g,"");e.push({link:"cyoa_page_"+a,html:s[o]})}return e},create_cover:function(){s=t("#"+i.container),s.addClass("cyoa_container")},create_back_button_elem:function(){return o=t('<li id="cyoa_back_button" class="disabled generic" value="back">Back</li>'),o.click(function(){i.back()}),o.addClass("cyoa_top_controls"),o},create_reset_button_elem:function(){return a=t('<li id="cyoa_reset_button" class="disabled generic" value="reset">Reset</li>'),a.click(function(){i.reset()}),a.addClass("cyoa_top_controls"),a},create_page:function(t){i.story[t].element=i.create_page_element(t),i.story[t].element.addClass("cyoa_hide"),i.story[t].element.append(i.create_controls(t)),s.append(i.story[t].element)},create_page_element:function(e){var n=i.story[e],s=n.html?n.html:n.img?'<img src="'+n.img+'" />':n.text?"<p>"+n.text+"</p>":"<p>No content provided.  That's unfortunate",o=t('<div id="'+e+'_container" class="cyoa_page"><div class="cyoa_content">'+s+"</div></div>");return o},add_to_path:function(t){r.push(t),r.length>1&&(o.removeClass("disabled"),a.removeClass("disabled"))},create_controls:function(e){var n=t('<ul id="'+e+'_controls" class="cyoa_controls"></ul>');"centered"==i.control_position&&n.addClass("centered"),"split"==i.control_position&&n.addClass("split"),"right"==i.control_position&&n.addClass("right"),"left"==i.control_position&&n.addClass("left");var s=i.story[e].connects,o=function(t,e){e.click(function(){i.add_to_path(t),i.display_page(t)})};for(var a in s){var r=s[a];if(i.story[r.link]){var l=t('<li class="cyoa_controler_'+r.link+'"></li>');l.append(t("<span>"+r.html+"</span>")),o(r.link,l),n.append(l)}}return n.append(i.create_reset_button_elem()),n.append(i.create_back_button_elem()),n},display_page:function(e){return t(".cyoa_page").addClass("cyoa_hide").removeClass("cyoa_show"),t("#"+e+"_container").removeClass("cyoa_hide"),t("#"+e+"_container").addClass("cyoa_show"),i},back:function(){return 1===r.length?(o.addClass("disabled"),void a.addClass("disabled")):(r.pop(),i.display_page(r[r.length-1]),1===r.length&&(o.addClass("disabled"),a.addClass("disabled")),void 0)},reset:function(){for(;r.length>1;)r.pop();i.display_page(r[0]),o.addClass("disabled"),a.addClass("disabled")}};return l.init(e,n)},t.fn.Cyoa=function(e,n){return n=n||{},n.container=this.attr("id"),this.cyoa=t.Cyoa(e,n),this}}(jQuery),function(t){"use strict";var e=!1;if("undefined"!=typeof module&&module.exports){e=!0;var n=require("request")}var s=!1,o=!1;try{var a=new XMLHttpRequest;"undefined"!=typeof a.withCredentials?s=!0:"XDomainRequest"in window&&(s=!0,o=!0)}catch(i){}var r=Array.prototype.indexOf,l=function(t,e){var n=0,s=t.length;if(r&&t.indexOf===r)return t.indexOf(e);for(;n<s;n++)if(t[n]===e)return n;return-1},c=function(t){return this&&this instanceof c?("string"==typeof t&&(t={key:t}),this.callback=t.callback,this.wanted=t.wanted||[],this.key=t.key,this.simpleSheet=!!t.simpleSheet,this.parseNumbers=!!t.parseNumbers,this.wait=!!t.wait,this.reverse=!!t.reverse,this.postProcess=t.postProcess,this.debug=!!t.debug,this.query=t.query||"",this.orderby=t.orderby,this.endpoint=t.endpoint||"https://spreadsheets.google.com",this.singleton=!!t.singleton,this.simple_url=!!t.simple_url,this.callbackContext=t.callbackContext,this.prettyColumnNames="undefined"==typeof t.prettyColumnNames||t.prettyColumnNames,"undefined"!=typeof t.proxy&&(this.endpoint=t.proxy.replace(/\/$/,""),this.simple_url=!0,this.singleton=!0,s=!1),this.parameterize=t.parameterize||!1,this.singleton&&("undefined"!=typeof c.singleton&&this.log("WARNING! Tabletop singleton already defined"),c.singleton=this),/key=/.test(this.key)&&(this.log("You passed an old Google Docs url as the key! Attempting to parse."),this.key=this.key.match("key=(.*?)(&|#|$)")[1]),/pubhtml/.test(this.key)&&(this.log("You passed a new Google Spreadsheets url as the key! Attempting to parse."),this.key=this.key.match("d\\/(.*?)\\/pubhtml")[1]),this.key?(this.log("Initializing with key "+this.key),this.models={},this.model_names=[],this.base_json_path="/feeds/worksheets/"+this.key+"/public/basic?alt=",e||s?this.base_json_path+="json":this.base_json_path+="json-in-script",void(this.wait||this.fetch())):void this.log("You need to pass Tabletop a key!")):new c(t)};c.callbacks={},c.init=function(t){return new c(t)},c.sheets=function(){this.log("Times have changed! You'll want to use var tabletop = Tabletop.init(...); tabletop.sheets(...); instead of Tabletop.sheets(...)")},c.prototype={fetch:function(t){"undefined"!=typeof t&&(this.callback=t),this.requestData(this.base_json_path,this.loadSheets)},requestData:function(t,n){if(e)this.serverSideFetch(t,n);else{var a=this.endpoint.split("//").shift()||"http";!s||o&&a!==location.protocol?this.injectScript(t,n):this.xhrFetch(t,n)}},xhrFetch:function(t,e){var n=o?new XDomainRequest:new XMLHttpRequest;n.open("GET",this.endpoint+t);var s=this;n.onload=function(){try{var t=JSON.parse(n.responseText)}catch(o){console.error(o)}e.call(s,t)},n.send()},injectScript:function(t,e){var n,s=document.createElement("script");if(this.singleton)e===this.loadSheets?n="Tabletop.singleton.loadSheets":e===this.loadSheet&&(n="Tabletop.singleton.loadSheet");else{var o=this;n="tt"+ +new Date+Math.floor(1e5*Math.random()),c.callbacks[n]=function(){var t=Array.prototype.slice.call(arguments,0);e.apply(o,t),s.parentNode.removeChild(s),delete c.callbacks[n]},n="Tabletop.callbacks."+n}var a=t+"&callback="+n;this.simple_url?t.indexOf("/list/")!==-1?s.src=this.endpoint+"/"+this.key+"-"+t.split("/")[4]:s.src=this.endpoint+"/"+this.key:s.src=this.endpoint+a,this.parameterize&&(s.src=this.parameterize+encodeURIComponent(s.src)),document.getElementsByTagName("script")[0].parentNode.appendChild(s)},serverSideFetch:function(t,e){var s=this;n({url:this.endpoint+t,json:!0},function(t,n,o){return t?console.error(t):void e.call(s,o)})},isWanted:function(t){return 0===this.wanted.length||l(this.wanted,t)!==-1},data:function(){if(0!==this.model_names.length)return this.simpleSheet?(this.model_names.length>1&&this.debug&&this.log("WARNING You have more than one sheet but are using simple sheet mode! Don't blame me when something goes wrong."),this.models[this.model_names[0]].all()):this.models},addWanted:function(t){l(this.wanted,t)===-1&&this.wanted.push(t)},loadSheets:function(t){var n,o,a=[];for(this.foundSheetNames=[],n=0,o=t.feed.entry.length;n<o;n++)if(this.foundSheetNames.push(t.feed.entry[n].title.$t),this.isWanted(t.feed.entry[n].content.$t)){var i=t.feed.entry[n].link.length-1,r=t.feed.entry[n].link[i].href.split("/").pop(),l="/feeds/list/"+this.key+"/"+r+"/public/values?alt=";l+=e||s?"json":"json-in-script",this.query&&(l+="&sq="+this.query),this.orderby&&(l+="&orderby=column:"+this.orderby.toLowerCase()),this.reverse&&(l+="&reverse=true"),a.push(l)}for(this.sheetsToLoad=a.length,n=0,o=a.length;n<o;n++)this.requestData(a[n],this.loadSheet)},sheets:function(t){return"undefined"==typeof t?this.models:"undefined"==typeof this.models[t]?void 0:this.models[t]},sheetReady:function(t){this.models[t.name]=t,l(this.model_names,t.name)===-1&&this.model_names.push(t.name),this.sheetsToLoad--,0===this.sheetsToLoad&&this.doCallback()},loadSheet:function(t){var e=this;new c.Model({data:t,parseNumbers:this.parseNumbers,postProcess:this.postProcess,tabletop:this,prettyColumnNames:this.prettyColumnNames,onReady:function(){e.sheetReady(this)}})},doCallback:function(){0===this.sheetsToLoad&&this.callback.apply(this.callbackContext||this,[this.data(),this])},log:function(t){this.debug&&"undefined"!=typeof console&&"undefined"!=typeof console.log&&Function.prototype.apply.apply(console.log,[console,arguments])}},c.Model=function(t){var e,n,s,o;if(this.column_names=[],this.name=t.data.feed.title.$t,this.tabletop=t.tabletop,this.elements=[],this.onReady=t.onReady,this.raw=t.data,"undefined"==typeof t.data.feed.entry)return t.tabletop.log("Missing data for "+this.name+", make sure you didn't forget column headers"),void(this.elements=[]);for(var a in t.data.feed.entry[0])/^gsx/.test(a)&&this.column_names.push(a.replace("gsx$",""));for(this.original_columns=this.column_names,e=0,s=t.data.feed.entry.length;e<s;e++){for(var i=t.data.feed.entry[e],r={},n=0,o=this.column_names.length;n<o;n++){var l=i["gsx$"+this.column_names[n]];"undefined"!=typeof l?t.parseNumbers&&""!==l.$t&&!isNaN(l.$t)?r[this.column_names[n]]=+l.$t:r[this.column_names[n]]=l.$t:r[this.column_names[n]]=""}void 0===r.rowNumber&&(r.rowNumber=e+1),t.postProcess&&t.postProcess(r),this.elements.push(r)}t.prettyColumnNames?this.fetchPrettyColumns():this.onReady.call(this)},c.Model.prototype={all:function(){return this.elements},fetchPrettyColumns:function(){if(!this.raw.feed.link[3])return this.ready();var t=this.raw.feed.link[3].href.replace("/feeds/list/","/feeds/cells/").replace("https://spreadsheets.google.com",""),e=this;this.tabletop.requestData(t,function(t){e.loadPrettyColumns(t)})},ready:function(){this.onReady.call(this)},loadPrettyColumns:function(t){for(var e={},n=this.column_names,s=0,o=n.length;s<o;s++)"undefined"!=typeof t.feed.entry[s].content.$t?e[n[s]]=t.feed.entry[s].content.$t:e[n[s]]=n[s];this.pretty_columns=e,this.prettifyElements(),this.ready()},prettifyElements:function(){var t,e,n,s,o,a=[],o=[];for(e=0,s=this.column_names.length;e<s;e++)o.push(this.pretty_columns[this.column_names[e]]);for(t=0,n=this.elements.length;t<n;t++){var i={};for(e=0,s=this.column_names.length;e<s;e++){var r=this.pretty_columns[this.column_names[e]];i[r]=this.elements[t][this.column_names[e]]}a.push(i)}this.elements=a,this.column_names=o},toArray:function(){var t,e,n,s,o=[];for(t=0,n=this.elements.length;t<n;t++){var a=[];for(e=0,s=this.column_names.length;e<s;e++)a.push(this.elements[t][this.column_names[e]]);o.push(a)}return o}},e?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t.Tabletop=c}(this),$(document).foundation(),function(t){t.fn.upUpDownDown=function(e){var n=t.extend({watchFor:[38,38,40,40,37,39,37,39,66,65],callback:function(){}},e),s=[],o=n.watchFor;t(document).keyup(function(e){len=s.push(e.keyCode?e.keyCode:e.charCode),len>o.length&&s.shift(),s.join("-")==o.join("-")&&(s=[],n.callback&&n.callback(t(this)))})}}(jQuery);var cyoa={initExternalLinks:function(){jQuery("a[rel*=external]").click(function(){return window.open(this.href),!1})},initSmoothScroll:function(){jQuery(".scroll[href*=\\#]:not([href=\\#])").click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var t=$(this.hash);if(t=t.length?t:jQuery("[name="+this.hash.slice(1)+"]"),t.length)return jQuery("html,body").animate({scrollTop:t.offset().top},1e3),!1}})},initContrast:function(){jQuery(".has-backgroundcolour").each(function(){var t=jQuery(this).css("background-color"),t=rgb2hex(t),e=getContrastYIQ(t);jQuery(this).css("color",e)})},initKonami:function(){jQuery("body").upUpDownDown({watchFor:[38,38,40,40,37,39,37,39,66,65],callback:function(){jQuery("body").append('<img src="/imgs/cat.png" alt="" style="position:fixed; bottom:-1275px; left:0; " class="kcode" />'),jQuery(".kcode").stop().animate({bottom:-20,left:0},200).animate({bottom:-40,left:50},200).animate({bottom:-20,left:100},200).animate({bottom:-40,left:150},200).animate({bottom:-20,left:200},200).animate({bottom:-40,left:250},200).animate({bottom:-20,left:300},200).animate({bottom:-40,left:350},200).animate({bottom:-20,left:400},200).animate({bottom:-40,left:450},200).animate({bottom:-20,left:500},200).animate({bottom:-40,left:550},200).animate({bottom:-20,left:600},200).animate({bottom:-40,left:650},200).animate({bottom:-20,left:700},200).animate({bottom:-40,left:750},200).animate({bottom:-20,left:800},200).animate({bottom:-40,left:850},200).animate({bottom:-20,left:900},200).animate({bottom:-1275,left:900},600,function(){jQuery(this).remove()})}})}};jQuery(document).ready(function(){cyoa.initExternalLinks(),cyoa.initSmoothScroll(),cyoa.initContrast(),cyoa.initKonami()});