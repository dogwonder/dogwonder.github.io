function displaySection(e){var t=markdown.toHTMLTree(sections[e]),r=markdown.renderJsonML(t);e!==title&&(r=r.replace(/<h1>.+<\/h1>/,"")),r=displayDecisions(r),$("#content").html(r.trim()),$("#content :empty").remove()}function displayDecisions(e){for(var t=$($.parseHTML(e)),r=$(".decisions",t),n=0;n<r.length;n++){for(var i=$($(".decisions",t).get(n)).attr("decisions").split(","),a=0,s=0;s<choices.length;s++)i.indexOf(choices[s])>=0&&a++;if(a==i.length){var o=$($(".decisions",t).get(n)).html();$($(".decisions",t).get(n)).replaceWith("<p>"+o+"</p>")}else $($(".decisions",t).get(n)).replaceWith("");n--,r=$(".decisions",t)}for(var l=document.createElement("div"),n=0;n<t.length;n++)l.appendChild(t[n]);return l.innerHTML}function getStory(){if(story)initializeStory(story);else{var e="./stories/",t="";t=getURLParam("story"),t||(t="adventure"),e=e+t+".md",$.get(e,function(e){initializeStory(e)})}}function initializeStory(e){parseSource(e),document.title=title,currentSection=title,displaySection(title),source=e}function loadStoryFromFile(e){var t,r=e.target.files[0];if(r){var n=new FileReader;n.onload=function(e){t=e.target.result,initializeStory(t)},n.readAsText(r)}}function parseSource(e){var t=parseStory(e);title=t[0][1][2],sections=parseBranches(t)}function parseStory(e){var t=markdown.parse(e),r=[],n=[];n.push("markdown");for(var i=!0,a=!1,s=1;s<t.length;s++){var o=t[s];"header"!==o[0]||1!==o[1].level||i?i=!1:a=!0,parseBranchLinks(o),a===!0&&(r.push(n),n=[],n.push("markdown"),a=!1),n.push(o)}return r.push(n),r}function parseBranchLinks(e){for(var t=0;t<e.length;t++)if(e[t].length>0&&"link"===e[t][0]){var r=e[t][1];if("choice:"===r.href.substring(0,7)){var n=r.href.substring(7);e[t][1].href="#choice",e[t][1]["class"]="choice",e[t][1].choice=n}else if("decisions:"===r.href.substring(0,10)){var i=r.href.substring(10);e[t][1].href="#decision",e[t][1]["class"]="decisions",e[t][1].decisions=i}else e[t][1].target="_blank"}}function parseBranches(e){for(var t=[],r=0;r<e.length;r++){var n=e[r][1][2];t[n]=e[r]}return t}function getURLParam(e){for(var t=window.location.search.substring(1),r=t.split("&"),n=0;n<r.length;n++){var i=r[n].split("=");if(i[0]==e){var a=i[1];if(/[\/\.]/.test(a)===!1)return a}}}function handleBack(){if(choices.length>0){var e=window.location.href.indexOf("#choice");if(e<0){var t=confirm("Your Adventure is still in progress. Would you like to return to the beginning?");t?document.location.reload(!0):(window.location.hash="choice",displaySection(currentSection))}}}function getContrastYIQ(e){var t=parseInt(e.substr(0,2),16),r=parseInt(e.substr(2,2),16),n=parseInt(e.substr(4,2),16),i=(299*t+587*r+114*n)/1e3;return i>=131.5?"rgba(0,0,0,.8)":"white"}function rgb2hex(e){function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),t(e[1])+t(e[2])+t(e[3])}!function(e){function t(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function r(){var e=require("util");return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}function n(e){for(var t=0,r=-1;(r=e.indexOf("\n",r+1))!==-1;)t++;return t}function i(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function a(e){if("string"==typeof e)return i(e);var t=e.shift(),r={},n=[];for(!e.length||"object"!=typeof e[0]||e[0]instanceof Array||(r=e.shift());e.length;)n.push(a(e.shift()));var s="";for(var o in r)s+=" "+o+'="'+i(r[o])+'"';return"img"===t||"br"===t||"hr"===t?"<"+t+s+"/>":"<"+t+s+">"+n.join("")+"</"+t+">"}function s(e,t,r){var n;r=r||{};var i=e.slice(0);"function"==typeof r.preprocessTreeNode&&(i=r.preprocessTreeNode(i,t));var a=p(i);if(a){i[1]={};for(n in a)i[1][n]=a[n];a=i[1]}if("string"==typeof i)return i;switch(i[0]){case"header":i[0]="h"+i[1].level,delete i[1].level;break;case"bulletlist":i[0]="ul";break;case"numberlist":i[0]="ol";break;case"listitem":i[0]="li";break;case"para":i[0]="p";break;case"markdown":i[0]="html",a&&delete a.references;break;case"code_block":i[0]="pre",n=a?2:1;var o=["code"];o.push.apply(o,i.splice(n,i.length-n)),i[n]=o;break;case"inlinecode":i[0]="code";break;case"img":i[1].src=i[1].href,delete i[1].href;break;case"linebreak":i[0]="br";break;case"link":i[0]="a";break;case"link_ref":i[0]="a";var l=t[a.ref];if(!l)return a.original;delete a.ref,a.href=l.href,l.title&&(a.title=l.title),delete a.original;break;case"img_ref":i[0]="img";var l=t[a.ref];if(!l)return a.original;delete a.ref,a.src=l.href,l.title&&(a.title=l.title),delete a.original}if(n=1,a){for(var c in i[1]){n=2;break}1===n&&i.splice(n,1)}for(;n<i.length;++n)i[n]=s(i[n],t,r);return i}function o(e){for(var t=p(e)?2:1;t<e.length;)"string"==typeof e[t]?t+1<e.length&&"string"==typeof e[t+1]?e[t]+=e.splice(t+1,1)[0]:++t:(o(e[t]),++t)}function l(e,t){function r(e){this.len_after=e,this.name="close_"+t}var n=e+"_state",i="strong"===e?"em_state":"strong_state";return function(a){if(this[n][0]===t)return this[n].shift(),[a.length,new r(a.length-t.length)];var s=this[i].slice(),o=this[n].slice();this[n].unshift(t);var l=this.processInline(a.substr(t.length)),c=l[l.length-1];this[n].shift();if(c instanceof r){l.pop();var u=a.length-c.len_after;return[u,[e].concat(l)]}return this[i]=s,this[n]=o,[t.length,t]}}function c(e){for(var t=e.split(""),r=[""],n=!1;t.length;){var i=t.shift();switch(i){case" ":n?r[r.length-1]+=i:r.push("");break;case"'":case'"':n=!n;break;case"\\":i=t.shift();default:r[r.length-1]+=i}}return r}var u={};u.mk_block=function(e,n,i){1===arguments.length&&(n="\n\n");var a=new String(e);return a.trailing=n,a.inspect=r,a.toSource=t,void 0!==i&&(a.lineNumber=i),a};var h=u.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};Array.prototype.forEach?u.forEach=function(e,t,r){return e.forEach(t,r)}:u.forEach=function(e,t,r){for(var n=0;n<e.length;n++)t.call(r||e,e[n],n,e)},u.isEmpty=function(e){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0},u.extract_attr=function(e){return h(e)&&e.length>1&&"object"==typeof e[1]&&!h(e[1])?e[1]:void 0};var f=function(e){switch(typeof e){case"undefined":this.dialect=f.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in f.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=f.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};f.dialects={};var g=f.mk_block=u.mk_block,h=u.isArray;f.parse=function(e,t){var r=new f(t);return r.toTree(e)},f.prototype.split_blocks=function(e){e=e.replace(/(\r\n|\n|\r)/g,"\n");var t,r=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,i=[],a=1;for(null!==(t=/^(\s*\n)/.exec(e))&&(a+=n(t[0]),r.lastIndex=t[0].length);null!==(t=r.exec(e));)"\n#"===t[2]&&(t[2]="\n",r.lastIndex--),i.push(g(t[1],t[2],a)),a+=n(t[0]);return i},f.prototype.processBlock=function(e,t){var r=this.dialect.block,n=r.__order__;if("__call__"in r)return r.__call__.call(this,e,t);for(var i=0;i<n.length;i++){var a=r[n[i]].call(this,e,t);if(a)return(!h(a)||a.length>0&&!h(a[0]))&&this.debug(n[i],"didn't return a proper array"),a}return[]},f.prototype.processInline=function(e){return this.dialect.inline.__call__.call(this,String(e))},f.prototype.toTree=function(e,t){var r=e instanceof Array?e:this.split_blocks(e),n=this.tree;try{for(this.tree=t||this.tree||["markdown"];r.length;){var i=this.processBlock(r.shift(),r);i.length&&this.tree.push.apply(this.tree,i)}return this.tree}finally{t&&(this.tree=n)}},f.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,e),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,e)},f.prototype.loop_re_over_block=function(e,t,r){for(var n,i=t.valueOf();i.length&&null!==(n=e.exec(i));)i=i.substr(n[0].length),r.call(this,n);return i},f.buildBlockOrder=function(e){var t=[];for(var r in e)"__order__"!==r&&"__call__"!==r&&t.push(r);e.__order__=t},f.buildInlinePatterns=function(e){var t=[];for(var r in e)if(!r.match(/^__.*__$/)){var n=r.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(1===r.length?n:"(?:"+n+")")}t=t.join("|"),e.__patterns__=t;var i=e.__call__;e.__call__=function(e,r){return void 0!==r?i.call(this,e,r):i.call(this,e,t)}};var p=u.extract_attr;f.renderJsonML=function(e,t){t=t||{},t.root=t.root||!1;var r=[];if(t.root)r.push(a(e));else for(e.shift(),!e.length||"object"!=typeof e[0]||e[0]instanceof Array||e.shift();e.length;)r.push(a(e.shift()));return r.join("\n\n")},f.toHTMLTree=function(e,t,r){"string"==typeof e&&(e=this.parse(e,t));var n=p(e),i={};n&&n.references&&(i=n.references);var a=s(e,i,r);return o(a),a},f.toHTML=function(e,t,r){var n=this.toHTMLTree(e,t,r);return this.renderJsonML(n)};var d={};d.inline_until_char=function(e,t){for(var r=0,n=[];;){if(e.charAt(r)===t)return r++,[r,n];if(r>=e.length)return null;var i=this.dialect.inline.__oneElement__.call(this,e.substr(r));r+=i[0],n.push.apply(n,i.slice(1))}},d.subclassDialect=function(e){function t(){}function r(){}return t.prototype=e.block,r.prototype=e.inline,{block:new t,inline:new r}};var v=u.forEach,p=u.extract_attr,g=u.mk_block,b=u.isEmpty,m=d.inline_until_char,y={block:{atxHeader:function(e,t){var r=e.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(r){var n=["header",{level:r[1].length}];return Array.prototype.push.apply(n,this.processInline(r[2])),r[0].length<e.length&&t.unshift(g(e.substr(r[0].length),e.trailing,e.lineNumber+2)),[n]}},setextHeader:function(e,t){var r=e.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(r){var n="="===r[2]?1:2,i=["header",{level:n},r[1]];return r[0].length<e.length&&t.unshift(g(e.substr(r[0].length),e.trailing,e.lineNumber+2)),[i]}},code:function(e,t){var r=[],n=/^(?: {0,3}\t| {4})(.*)\n?/;if(e.match(n)){e:for(;;){var i=this.loop_re_over_block(n,e.valueOf(),function(e){r.push(e[1])});if(i.length){t.unshift(g(i,e.trailing));break e}if(!t.length)break e;if(!t[0].match(n))break e;r.push(e.trailing.replace(/[^\n]/g,"").substring(2)),e=t.shift()}return[["code_block",r.join("\n")]]}},horizRule:function(e,t){var r=e.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(r){var n=[["hr"]];if(r[1]){var i=g(r[1],"",e.lineNumber);n.unshift.apply(n,this.toTree(i,[]))}return r[3]&&t.unshift(g(r[3],e.trailing,e.lineNumber+1)),n}},lists:function(){function e(e){return new RegExp("(?:^("+l+"{0,"+e+"} {0,3})("+a+")\\s+)|(^"+l+"{0,"+(e-1)+"}[ ]{0,4})")}function t(e){return e.replace(/ {0,3}\t/g,"    ")}function r(e,t,r,n){if(t)return void e.push(["para"].concat(r));var i=e[e.length-1]instanceof Array&&"para"===e[e.length-1][0]?e[e.length-1]:e;n&&e.length>1&&r.unshift(n);for(var a=0;a<r.length;a++){var s=r[a],o="string"==typeof s;o&&i.length>1&&"string"==typeof i[i.length-1]?i[i.length-1]+=s:i.push(s)}}function n(e,t){for(var r=new RegExp("^("+l+"{"+e+"}.*?\\n?)*$"),n=new RegExp("^"+l+"{"+e+"}","gm"),i=[];t.length>0&&r.exec(t[0]);){var a=t.shift(),s=a.replace(n,"");i.push(g(s,a.trailing,a.lineNumber))}return i}function i(e,t,r){var n=e.list,i=n[n.length-1];if(!(i[1]instanceof Array&&"para"===i[1][0]))if(t+1===r.length)i.push(["para"].concat(i.splice(1,i.length-1)));else{var a=i.pop();i.push(["para"].concat(i.splice(1,i.length-1)),a)}}var a="[*+-]|\\d+\\.",s=/[*+-]/,o=new RegExp("^( {0,3})("+a+")[ \t]+"),l="(?: {0,3}\\t| {4})";return function(a,l){function c(e){var t=s.exec(e[2])?["bulletlist"]:["numberlist"];return g.push({list:t,indent:e[1]}),t}var u=a.match(o);if(u){for(var h,f,g=[],p=c(u),d=!1,b=[g[0].list];;){for(var m=a.split(/(?=\n)/),y="",_="",k=0;k<m.length;k++){_="";var w=m[k].replace(/^\n/,function(e){return _=e,""}),$=e(g.length);if(u=w.match($),void 0!==u[1]){y.length&&(r(h,d,this.processInline(y),_),d=!1,y=""),u[1]=t(u[1]);var S=Math.floor(u[1].length/4)+1;if(S>g.length)p=c(u),h.push(p),h=p[1]=["listitem"];else{var x=!1;for(f=0;f<g.length;f++)if(g[f].indent===u[1]){p=g[f].list,g.splice(f+1,g.length-(f+1)),x=!0;break}x||(S++,S<=g.length?(g.splice(S,g.length-S),p=g[S-1].list):(p=c(u),h.push(p))),h=["listitem"],p.push(h)}_=""}w.length>u[0].length&&(y+=_+w.substr(u[0].length))}y.length&&(r(h,d,this.processInline(y),_),d=!1,y="");var L=n(g.length,l);L.length>0&&(v(g,i,this),h.push.apply(h,this.toTree(L,[])));var A=l[0]&&l[0].valueOf()||"";if(!A.match(o)&&!A.match(/^ /))break;a=l.shift();var E=this.dialect.block.horizRule(a,l);if(E){b.push.apply(b,E);break}v(g,i,this),d=!0}return b}}}(),blockquote:function(e,t){if(e.match(/^>/m)){var r=[];if(">"!==e[0]){for(var n=e.split(/\n/),i=[],a=e.lineNumber;n.length&&">"!==n[0][0];)i.push(n.shift()),a++;var s=g(i.join("\n"),"\n",e.lineNumber);r.push.apply(r,this.processBlock(s,[])),e=g(n.join("\n"),e.trailing,a)}for(;t.length&&">"===t[0][0];){var o=t.shift();e=g(e+e.trailing+o,o.trailing,e.lineNumber)}var l=e.replace(/^> ?/gm,""),c=(this.tree,this.toTree(l,["blockquote"])),u=p(c);return u&&u.references&&(delete u.references,b(u)&&c.splice(1,1)),r.push(c),r}},referenceDefn:function(e,t){var r=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(e.match(r)){p(this.tree)||this.tree.splice(1,0,{});var n=p(this.tree);void 0===n.references&&(n.references={});var i=this.loop_re_over_block(r,e,function(e){e[2]&&"<"===e[2][0]&&">"===e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1));var t=n.references[e[1].toLowerCase()]={href:e[2]};void 0!==e[4]?t.title=e[4]:void 0!==e[5]&&(t.title=e[5])});return i.length&&t.unshift(g(i,e.trailing)),[]}},para:function(e){return[["para"].concat(this.processInline(e))]}},inline:{__oneElement__:function(e,t,r){var n,i;t=t||this.dialect.inline.__patterns__;var a=new RegExp("([\\s\\S]*?)("+(t.source||t)+")");if(n=a.exec(e),!n)return[e.length,e];if(n[1])return[n[1].length,n[1]];var i;return n[2]in this.dialect.inline&&(i=this.dialect.inline[n[2]].call(this,e.substr(n.index),n,r||[])),i=i||[n[2].length,n[2]]},__call__:function(e,t){function r(e){"string"==typeof e&&"string"==typeof i[i.length-1]?i[i.length-1]+=e:i.push(e)}for(var n,i=[];e.length>0;)n=this.dialect.inline.__oneElement__.call(this,e,t,i),e=e.substr(n.shift()),v(n,r);return i},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(e){return this.dialect.inline.__escape__.exec(e)?[2,e.charAt(1)]:[1,"\\"]},"![":function(e){var t=e.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(t){t[2]&&"<"===t[2][0]&&">"===t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1)),t[2]=this.dialect.inline.__call__.call(this,t[2],/\\/)[0];var r={alt:t[1],href:t[2]||""};return void 0!==t[4]&&(r.title=t[4]),[t[0].length,["img",r]]}return t=e.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),t?[t[0].length,["img_ref",{alt:t[1],ref:t[2].toLowerCase(),original:t[0]}]]:[2,"!["]},"[":function k(e){var t=String(e),r=m.call(this,e.substr(1),"]");if(!r)return[1,"["];var k,n,i=1+r[0],a=r[1];e=e.substr(i);var s=e.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(s){var o=s[1];if(i+=s[0].length,o&&"<"===o[0]&&">"===o[o.length-1]&&(o=o.substring(1,o.length-1)),!s[3])for(var l=1,c=0;c<o.length;c++)switch(o[c]){case"(":l++;break;case")":0===--l&&(i-=o.length-c,o=o.substring(0,c))}return o=this.dialect.inline.__call__.call(this,o,/\\/)[0],n={href:o||""},void 0!==s[3]&&(n.title=s[3]),k=["link",n].concat(a),[i,k]}return s=e.match(/^\s*\[(.*?)\]/),s?(i+=s[0].length,n={ref:(s[1]||String(a)).toLowerCase(),original:t.substr(0,i)},k=["link_ref",n].concat(a),[i,k]):1===a.length&&"string"==typeof a[0]?(n={ref:a[0].toLowerCase(),original:t.substr(0,i)},k=["link_ref",n,a[0]],[i,k]):[1,"["]},"<":function(e){var t;return null!==(t=e.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?t[3]?[t[0].length,["link",{href:"mailto:"+t[3]},t[3]]]:"mailto"===t[2]?[t[0].length,["link",{href:t[1]},t[1].substr("mailto:".length)]]:[t[0].length,["link",{href:t[1]},t[1]]]:[1,"<"]},"`":function(e){var t=e.match(/(`+)(([\s\S]*?)\1)/);return t&&t[2]?[t[1].length+t[2].length,["inlinecode",t[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}}};y.inline["**"]=l("strong","**"),y.inline.__=l("strong","__"),y.inline["*"]=l("em","*"),y.inline._=l("em","_"),f.dialects.Gruber=y,f.buildBlockOrder(f.dialects.Gruber.block),f.buildInlinePatterns(f.dialects.Gruber.inline);var _=d.subclassDialect(y),p=u.extract_attr,v=u.forEach;_.processMetaHash=function(e){for(var t=c(e),r={},n=0;n<t.length;++n)if(/^#/.test(t[n]))r.id=t[n].substring(1);else if(/^\./.test(t[n]))r["class"]?r["class"]=r["class"]+t[n].replace(/./," "):r["class"]=t[n].substring(1);else if(/\=/.test(t[n])){var i=t[n].split(/\=/);r[i[0]]=i[1]}return r},_.block.document_meta=function(e){if(!(e.lineNumber>1)&&e.match(/^(?:\w+:.*\n)*\w+:.*$/)){p(this.tree)||this.tree.splice(1,0,{});var t=e.split(/\n/);for(var r in t){var n=t[r].match(/(\w+):\s*(.*)$/),i=n[1].toLowerCase(),a=n[2];this.tree[1][i]=a}return[]}},_.block.block_meta=function(e){var t=e.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(t){var r,n=this.dialect.processMetaHash(t[2]);if(""===t[1]){var i=this.tree[this.tree.length-1];if(r=p(i),"string"==typeof i)return;r||(r={},i.splice(1,0,r));for(var a in n)r[a]=n[a];return[]}var s=e.replace(/\n.*$/,""),o=this.processBlock(s,[]);r=p(o[0]),r||(r={},o[0].splice(1,0,r));for(var a in n)r[a]=n[a];return o}},_.block.definition_list=function(e,t){var r,n,i=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,a=["dl"];if(n=e.match(i)){for(var s=[e];t.length&&i.exec(t[0]);)s.push(t.shift());for(var o=0;o<s.length;++o){var n=s[o].match(i),l=n[1].replace(/\n$/,"").split(/\n/),c=n[2].split(/\n:\s+/);for(r=0;r<l.length;++r)a.push(["dt",l[r]]);for(r=0;r<c.length;++r)a.push(["dd"].concat(this.processInline(c[r].replace(/(\n)\s+/,"$1"))))}return[a]}},_.block.table=function w(e){var t,r,n=function(e,t){t=t||"\\s",t.match(/^[\\|\[\]{}?*.+^$]$/)&&(t="\\"+t);for(var r,n=[],i=new RegExp("^((?:\\\\.|[^\\\\"+t+"])*)"+t+"(.*)");r=e.match(i);)n.push(r[1]),e=r[2];return n.push(e),n},i=/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/,a=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;if(r=e.match(i))r[3]=r[3].replace(/^\s*\|/gm,"");else if(!(r=e.match(a)))return;var w=["table",["thead",["tr"]],["tbody"]];r[2]=r[2].replace(/\|\s*$/,"").split("|");var s=[];for(v(r[2],function(e){e.match(/^\s*-+:\s*$/)?s.push({align:"right"}):e.match(/^\s*:-+\s*$/)?s.push({align:"left"}):e.match(/^\s*:-+:\s*$/)?s.push({align:"center"}):s.push({})}),r[1]=n(r[1].replace(/\|\s*$/,""),"|"),t=0;t<r[1].length;t++)w[1][1].push(["th",s[t]||{}].concat(this.processInline(r[1][t].trim())));return v(r[3].replace(/\|\s*$/gm,"").split("\n"),function(e){var r=["tr"];for(e=n(e,"|"),t=0;t<e.length;t++)r.push(["td",s[t]||{}].concat(this.processInline(e[t].trim())));w[2].push(r)},this),[w]},_.inline["{:"]=function(e,t,r){if(!r.length)return[2,"{:"];var n=r[r.length-1];if("string"==typeof n)return[2,"{:"];var i=e.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!i)return[2,"{:"];var a=this.dialect.processMetaHash(i[1]),s=p(n);s||(s={},n.splice(1,0,s));for(var o in a)s[o]=a[o];return[i[0].length,""]},f.dialects.Maruku=_,f.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,f.buildBlockOrder(f.dialects.Maruku.block),f.buildInlinePatterns(f.dialects.Maruku.inline),e.Markdown=f,e.parse=f.parse,e.toHTML=f.toHTML,e.toHTMLTree=f.toHTMLTree,e.renderJsonML=f.renderJsonML}(function(){return window.markdown={},window.markdown}());var story="",title,sections=[],currentSection,choices=[],source,filesSupported;$(document).ready(function(){window.File&&window.FileReader&&window.FileList&&window.Blob&&(filesSupported=!0),window.location.hash&&(window.location.hash="",document.location.reload()),$(document).on("click","#content a",function(e){var t=$(this).attr("choice"),r=t.replace(/\s+/g,"-").toLowerCase();t&&(choices.push(t),currentSection=t,displaySection(t)),$("#coya").attr("data-story",""),$("#coya").attr("data-story",r),$(".story__background img").attr("src","dist/images/backgrounds/default.jpg"),$(".story__background img").attr("src",function(e,t){return $(this).attr("src").replace("default.jpg",r+".jpg")})}),window.onbeforeunload=function(){handleBack()},window.onhashchange=function(){handleBack()},getStory()}),!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],function(){return e.colorify=t()}):"object"==typeof exports?module.exports=t():e.colorify=t()}(this,function(){"use strict";var e=function(e){var t=(e.id||1,e.container||"colorify"),r=e.images||!1,n=e.accuracy||100,i=e.lazyReveal||!1,a=e.gradient||!1,s=e.gradientDirection||"to bottom right",o=e.padding||4,l=e.give||!1,c=e.revealOn||!1;if(0==!i)var u=e.lazyReveal.transition||0,h=e.lazyReveal.delay||0,f=e.lazyReveal.steps||!1;if(0==!c)var g=e.revealOn.event||!1,p=e.revealOn.trigger||!1;if(0==!l)var d=e.give.property||!1,v=e.give.target||!1;for(var b=document.querySelectorAll("["+t+"]"),m=0,y=b.length;y>m;m++)var _=e.attr||t+"-"+m;if(0==!r)for(var m=0,y=r.length;y>m;m++)for(var m=([r[m]],0);y>m;m++){var k=document.createElement("img");k.setAttribute(_,""),k.crossOrigin="Anonymous",k.src=r[m];var w=document.createElement("div");w.classList.add("image-container"),w.setAttribute("style","padding: "+o+"px;"),0==!c&&(w.style.opacity="0",w.classList.add("to-reveal")),w.appendChild(k),document.querySelector("["+t+"]").appendChild(w)}for(var $=document.querySelectorAll("["+t+"] img"),m=0,y=$.length;y>m;m++)$[m].setAttribute(_,""),$[m].classList.add("colorify");for(var S=document.querySelectorAll("["+_+"]"),x=S.length,L=0,m=0,y=S.length;y>m;m++){S[m].setAttribute(_,""),S.crossOrigin="Anonymous",S.src=S[m];var w=document.createElement("div");w.classList.add("image-container"),w.setAttribute("style","padding: "+o+"px;"),0==!c&&(w.style.opacity="0",w.classList.add("to-reveal")),w.appendChild(S[m]);var A=document.querySelector("["+t+"]");A.appendChild(w)}if(0==!c){var E=document.querySelectorAll(".to-reveal");document.querySelector(p).addEventListener(g,function(){for(var e=0,t=E.length;t>e;e++)E[e].style.opacity="1"})}setTimeout(function(){function e(e,t){var n=r(e);if(a){var i="rgb("+n[0].r+","+n[0].g+","+n[0].b+"), rgb("+n[1].r+","+n[1].g+","+n[1].b+")";e.parentNode.style.backgroundImage="linear-gradient("+s+","+i+") "}else e.parentNode.style.backgroundColor="rgb("+n[0].r+","+n[0].g+","+n[0].b+")";if(0==!l){var o=v.substring(0,1);if("#"==o||"."==o||"*"==o||"["==o)for(var c=document.querySelectorAll(v),g=0,p=c.length;p>g;g++)c[g].setAttribute("style",d+": rgb("+n[0].r+","+n[0].g+","+n[0].b+")");"parent"==v&&e.parentNode.parentNode.setAttribute("style",d+": rgb("+n[0].r+","+n[0].g+","+n[0].b+") !important"),"child"==v&&e.childNode.setAttribute("style",d+": rgb("+n[0].r+","+n[0].g+","+n[0].b+") !important")}(0==!u&&0==!h||0==!u||0==!h)&&(1==f?e.setAttribute("style","transition: all "+u+"s ease "+h*t+"s;"):e.setAttribute("style","transition: all "+u+"s ease "+h+"s;")),e.classList.add("visible","all-not-loaded"),L>=x&&(e.classList.remove("all-not-loaded"),e.classList.add("all-loaded"))}function t(e,t){var r={r:0,g:0,b:0},n=e.data.length,i=0,a=-4;t=t||{},t.accuracy=t.accuracy||1;for(var s=t.accuracy;(a+=4*s)<n;)++i,r.r+=e.data[a],r.g+=e.data[a+1],r.b+=e.data[a+2];return r.r=~~(r.r/i),r.g=~~(r.g/i),r.b=~~(r.b/i),r}function r(e){var r,i,s={r:0,g:0,b:0},o=document.createElement("canvas"),l=o.getContext&&o.getContext("2d"),c={r:0,g:0,b:0};if(!l)return s;if(i=o.height=e.naturalHeight||e.offsetHeight||e.height,r=o.width=e.naturalWidth||e.offsetWidth||e.width,l.drawImage(e,0,0),a){try{var u=t(l.getImageData(0,0,r/4,i/4),{accuracy:n});rgbEnd=t(l.getImageData(r-r/4,i-i/4,r/4,i/4),{accuracy:n})}catch(h){console.log("image cannot be processed",h),u=s,rgbEnd=s}return[u,rgbEnd]}try{c=t(l.getImageData(0,0,r,i),{accuracy:n})}catch(h){console.log("image cannot be processed",h),c=s}return[c]}for(m=0;x>m;m++)L++,S[m].onload=e(S[m],L)})};return e}),$(document).foundation();var cyoa={initExternalLinks:function(){jQuery("a[rel*=external]").click(function(){return window.open(this.href),!1})},initSmoothScroll:function(){jQuery(".scroll[href*=\\#]:not([href=\\#])").click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var e=$(this.hash);if(e=e.length?e:jQuery("[name="+this.hash.slice(1)+"]"),e.length)return jQuery("html,body").animate({scrollTop:e.offset().top},1e3),!1}})},initColorify:function(){colorify({container:"colorify-main-color",accuracy:10,give:{property:"background-color",target:".story"}})},initContrast:function(){var e=jQuery(".story").css("background-color"),e=rgb2hex(e),t=getContrastYIQ(e);jQuery(".story").css("color",t)}};jQuery(document).ready(function(){cyoa.initExternalLinks(),cyoa.initSmoothScroll(),cyoa.initColorify()}),jQuery(window).load(function(){cyoa.initContrast()});